rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 테스트를 위해 모든 접근 허용 (개발 환경에서만 사용)
    match /{document=**} {
      allow read, write: if true;
    }
    
    // 실제 운영 환경에서는 아래 규칙을 사용하세요
    // 아래 규칙은 현재 주석 처리되어 있어 적용되지 않습니다
    
    /* 
    // 기본적으로, 로그인한 사용자는 모든 데이터를 읽을 수 있게 허용
    match /{document=**} {
      allow read: if request.auth != null;
    }

    // 'user' 컬렉션: 사용자는 자신의 정보만 생성하고 수정할 수 있음
    match /user/{userId} {
      // 인증된 사용자는 자신의 정보 수정 가능
      allow update: if request.auth.uid == userId;
      
      // 회원가입을 위해 인증된 사용자가 자신의 문서를 생성할 수 있도록 허용
      allow create: if request.auth != null && request.auth.uid == userId;
    }

    // 'learningRecords' 컬렉션: 사용자는 자신의 학습 기록만 생성하고 수정할 수 있음
    match /learningRecords/{recordId} {
      // 활성화된 사용자만 학습 기록 생성/수정 가능
      allow create, update: if request.auth.uid == request.resource.data.userId && 
                              get(/databases/$(database)/documents/user/$(request.auth.uid)).data.status == 'active';
    }

    // 'contents' 컬렉션: (추후 관리자만 쓰도록 설정 예정)
    match /contents/{contentId} {
      allow write: if false;
    }
    
    // 'categories' 컬렉션: (추후 관리자만 쓰도록 설정 예정)
    match /categories/{categoryId} {
      allow write: if false;
    }
    */
  }
}

